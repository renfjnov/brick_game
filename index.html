<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Brick Game</title>
    <style>
        #id-canvas {
            border: 1px solid black;
        }
    </style>
</head>
<body>
    <canvas id="id-canvas" width="400" height="300"></canvas>
    <hr>
    <input type="range" id="id-input-fps">
    <script src="levels.js"></script>
    <script src="utils.js"></script>
    <script src="game.js"></script>
    <script src="ball.js"></script>
    <script src="brick.js"></script>
    <script src="paddle.js"></script>
    <script src="scene_end.js"></script>
    <script src="scene.js"></script>
    <script>

let paused = false

let loadLevels = function(n, game) {
        let bricks = []
        log(levels)
        let positions = levels[n]
        for (let i = 0; i < positions.length; i++) {
            let p = positions[i]
            let brick = new Brick(p, game)
            bricks.push(brick)
        }
        return bricks
    }

let enableDebugMode = function(enabled, game, ball) {
    if (!enabled) {
        return
    }
    // 增加暂停功能
    window.addEventListener('keydown', function(event) {
        if (event.key === 'p') {
            paused = !paused
        }
    })
    // 增加调整 fps 功能
    let inputFps = document.querySelector('#id-input-fps')
    inputFps.addEventListener('change', function() {
        log(inputFps.value)
        window.fps = inputFps.value
    })
    // 加入载入关卡功能
    window.addEventListener('keydown', function(event){
        let k = event.key
        if ('1234567'.includes(k)) {
            log('1234 pressed')
            let n = parseInt(k) - 1
            window.bricks = loadLevels(n, game)
        }
    })
    // 增加拖动功能
    let clicked = false
    game.canvas.addEventListener('mousedown', function(event) {
        if(isClicked(event, ball)) {
            clicked = true
        }
    })
    game.canvas.addEventListener('mousemove', function(event) {
        if (clicked) {
            ball.x = event.offsetX
            ball.y = event.offsetY
        }
    })
    game.canvas.addEventListener('mouseup', function(event) {
        clicked = false
    })
}

let __main = function() {
    window.fps = 30
    let images = {
        brick: 'brick.png',
        ball: 'ball.png',
        paddle: 'paddle.png',
    }
    let game = Game(window.fps, images, function (g) {
        let scene = Scene(g)
        g.scene = scene
    })
}

        __main()
    </script>
</body>
</html>